# –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ Mini App –≤ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

1. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `frontend/vite.config.js` –¥–ª—è production-—Å–±–æ—Ä–∫–∏
2. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `nginx/conf.d/miniapp-static.conf` –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏
3. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `docker-compose.yml` - frontend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω
4. ‚úÖ –°–æ–∑–¥–∞–Ω `docker-compose.static.yml` –∫–∞–∫ –ø—Ä–∏–º–µ—Ä –±–µ–∑ frontend
5. ‚úÖ –°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã —Å–±–æ—Ä–∫–∏: `scripts/build-frontend-static.sh` –∏ `.ps1`
6. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `frontend/index.html` —Å –º–µ—Ç–∞-—Ç–µ–≥–∞–º–∏ –¥–ª—è Telegram WebView
7. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ production-—Å–±–æ—Ä–∫–∞ - —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üìã –®–∞–≥–∏ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### –®–∞–≥ 1: –°–±–æ—Ä–∫–∞ —Å—Ç–∞—Ç–∏–∫–∏ (–ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ –≤ CI/CD)

```bash
# Linux/macOS
export VITE_API_URL=https://api.micro-tab.ru:9443
./scripts/build-frontend-static.sh

# Windows
$env:VITE_API_URL="https://api.micro-tab.ru:9443"
.\scripts\build-frontend-static.ps1

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é
cd frontend
export VITE_API_URL=https://api.micro-tab.ru:9443
npm ci
npm run build
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –≤ `frontend/dist/`

### –®–∞–≥ 2: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏
sudo mkdir -p /var/www/miniapp
sudo chown -R www-data:www-data /var/www/miniapp
sudo chmod -R 755 /var/www/miniapp
```

### –®–∞–≥ 3: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

```bash
# –° –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã —á–µ—Ä–µ–∑ SCP
scp -r frontend/dist/* user@server:/var/www/miniapp/

# –ò–ª–∏ —á–µ—Ä–µ–∑ rsync
rsync -avz --delete frontend/dist/ user@server:/var/www/miniapp/
```

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ: —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo cp nginx/conf.d/miniapp-static.conf /etc/nginx/conf.d/

# –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å –≤—Ä—É—á–Ω—É—é
sudo nano /etc/nginx/conf.d/miniapp-static.conf
```

**–í–∞–∂–Ω–æ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `miniapp-static.conf` (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ö–æ—Å—Ç–∏–Ω–≥)
- –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `frontend.conf` (proxy_pass –Ω–∞ –ø–æ—Ä—Ç 3000)
- `root /var/www/miniapp;` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ Nginx

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo nginx -t

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Nginx
sudo systemctl reload nginx
```

### –®–∞–≥ 6: –û—Å—Ç–∞–Ω–æ–≤–∫–∞ frontend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω)

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å frontend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker compose stop frontend
docker compose rm -f frontend

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å docker-compose.static.yml
docker compose -f docker-compose.static.yml up -d
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏–∫–∏ —á–µ—Ä–µ–∑ curl

```bash
curl -I https://miniapp.micro-tab.ru:4443
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
HTTP/2 200
content-type: text/html
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

–û—Ç–∫—Ä–æ–π—Ç–µ `https://miniapp.micro-tab.ru:4443` - –¥–æ–ª–∂–Ω–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞.

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Telegram

–û—Ç–∫—Ä–æ–π—Ç–µ Mini App –≤ Telegram - –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫.

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ Nginx

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫–∏
sudo tail -f /var/log/nginx/miniapp_error.log

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø
sudo tail -f /var/log/nginx/miniapp_access.log
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:

- ‚ùå `proxy_pass http://127.0.0.1:3000` –≤ nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚ùå –ó–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ frontend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞ –ø–æ—Ä—Ç—É 3000
- ‚ùå –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç Node.js –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–ª—è miniapp
- ‚ùå Dev-—Å–µ—Ä–≤–µ—Ä–æ–≤ –∏–ª–∏ HMR

### –î–û–õ–ñ–ù–û –±—ã—Ç—å:

- ‚úÖ `root /var/www/miniapp;` –≤ nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –≤ `/var/www/miniapp/`
- ‚úÖ `try_files $uri $uri/ /index.html;` –¥–ª—è SPA routing
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (www-data:www-data)

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏–∫–∏

–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:

1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–±–æ—Ä–∫—É (–®–∞–≥ 1)
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–®–∞–≥ 3)
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Nginx (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ): `sudo systemctl reload nginx`

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### 502 Bad Gateway

**–ü—Ä–∏—á–∏–Ω–∞:** Nginx –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ—Ä—Ç 3000.

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `miniapp-static.conf`
2. –£–¥–∞–ª–∏—Ç–µ –∏–ª–∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ `frontend.conf` —Å `proxy_pass`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: `sudo nginx -t && sudo systemctl reload nginx`

### 404 Not Found

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å –∫ —Å—Ç–∞—Ç–∏–∫–µ –∏–ª–∏ —Ñ–∞–π–ª—ã –Ω–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `root /var/www/miniapp;` –≤ nginx
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã: `ls -la /var/www/miniapp/`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞: `sudo chown -R www-data:www-data /var/www/miniapp`

### –ë–µ–ª—ã–π —ç–∫—Ä–∞–Ω –≤ Telegram

**–ü—Ä–∏—á–∏–Ω–∞:** –û—à–∏–±–∫–∏ JavaScript –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—É—Ç–∏ –∫ –∞—Å—Å–µ—Ç–∞–º.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ nginx: `sudo tail -f /var/log/nginx/miniapp_error.log`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `base: '/'` –≤ `vite.config.js`

## üìä –ò—Ç–æ–≥–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Telegram WebView‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ HTTPS (4443)
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Nginx (SSL)    ‚îÇ
‚îÇ miniapp-static   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ /var/www/miniapp ‚îÇ
‚îÇ  (—Å—Ç–∞—Ç–∏–∫–∞)      ‚îÇ
‚îÇ  - index.html   ‚îÇ
‚îÇ  - assets/      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ù–µ—Ç:**
- ‚ùå Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ frontend
- ‚ùå –ü–æ—Ä—Ç–∞ 3000
- ‚ùå Node.js –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- ‚ùå Dev-—Å–µ—Ä–≤–µ—Ä–æ–≤
- ‚ùå Proxy_pass

**–ï—Å—Ç—å:**
- ‚úÖ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
- ‚úÖ –ü—Ä—è–º–∞—è –æ—Ç–¥–∞—á–∞ —á–µ—Ä–µ–∑ Nginx
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞

