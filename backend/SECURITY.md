# Политика безопасности и управление уязвимостями

**Дата создания:** 2025-01-19  
**Последнее обновление:** 2025-01-19

---

## Обзор

Этот документ описывает политику безопасности проекта, процесс управления уязвимостями и документирует решения по уязвимостям со статусом `will_not_fix`.

---

## Процесс управления уязвимостями

### 1. Регулярное сканирование

Проект использует **Trivy** для сканирования Docker образов на наличие уязвимостей:

```bash
# Полное сканирование
trivy image tg_bot_hb-backend

# Сканирование по приоритетам
trivy image --severity CRITICAL,HIGH,MEDIUM tg_bot_hb-backend

# Экспорт отчета
trivy image --format json --output trivy-report.json tg_bot_hb-backend
```

**Частота сканирования:**
- Перед каждым релизом
- После обновления базового образа
- После обновления системных пакетов
- Еженедельно (автоматически через CI/CD)

### 2. Приоритизация исправлений

Уязвимости приоритизируются следующим образом:

1. **CRITICAL** — Немедленное исправление (в течение 24-48 часов)
2. **HIGH** — Срочное исправление (в течение недели)
3. **MEDIUM** — Плановое исправление (в течение 2 недель)
4. **LOW** — Исправление при возможности
5. **UNKNOWN** — Проверка и оценка риска

### 3. Процесс исправления

1. **Идентификация:** Обнаружение уязвимости через сканирование
2. **Оценка:** Определение критичности и риска
3. **Планирование:** Создание плана исправления
4. **Исправление:** Обновление пакетов или базового образа
5. **Проверка:** Повторное сканирование для подтверждения исправления
6. **Документирование:** Обновление этого документа

---

## Уязвимости со статусом `will_not_fix`

Уязвимости со статусом `will_not_fix` означают, что исправление не планируется для текущей версии пакета в Debian. В таких случаях принимаются следующие меры:

1. **Обновление базового образа** — переход на более новую версию Debian
2. **Ограничение поверхности атаки** — минимизация использования уязвимого компонента
3. **Документирование** — фиксация принятого решения и обоснования
4. **Мониторинг** — отслеживание доступности исправлений

---

## Документированные уязвимости `will_not_fix`

### 1. zlib1g: CVE-2023-45853 (CRITICAL)

**Пакет:** `zlib1g`  
**Версия:** `1:1.2.13.dfsg-1`  
**Уязвимость:** Integer overflow and heap-based buffer overflow  
**Статус:** `will_not_fix`  
**Дата обнаружения:** 2025-01-19

**Описание:**
Критическая уязвимость в zlib, связанная с переполнением целочисленных значений и переполнением буфера в куче в функции `zipOpenNewFileInZip4_6`.

**Риск:**
- Высокий риск эксплуатации
- Может привести к выполнению произвольного кода
- zlib используется повсеместно для сжатия данных

**Принятое решение:**
1. **Текущее состояние:** Пакет находится на последней доступной версии для Debian 12 (bookworm)
2. **Меры по снижению риска:**
   - Контейнер работает от non-root пользователя (`appuser`)
   - Ограничен доступ к системным файлам
   - Регулярное обновление базового образа через `apt-get upgrade`
3. **Планы на будущее:**
   - Мониторинг доступности обновлений для Debian 12
   - Рассмотрение перехода на Debian 13 (trixie) при стабильности
   - Регулярное сканирование для отслеживания изменений

**Обоснование:**
- Исправление недоступно для текущей версии Debian 12
- Переход на Debian 13 требует тестирования совместимости
- Принятые меры снижают риск эксплуатации
- zlib используется косвенно через системные библиотеки Python

**Ссылка:** https://avd.aquasec.com/nvd/cve-2023-45853

---

### 2. libpam-*: CVE-2025-6020 (HIGH)

**Пакеты:**
- `libpam-modules` (1.5.2-6+deb12u1)
- `libpam-modules-bin`
- `libpam-runtime`
- `libpam0g`

**Уязвимость:** Linux-pam directory Traversal  
**Статус:** `affected`  
**Дата обнаружения:** 2025-01-19

**Описание:**
Уязвимость обхода каталогов в Linux PAM (Pluggable Authentication Modules).

**Риск:**
- Высокий риск эксплуатации
- Может позволить атакующему получить несанкционированный доступ
- PAM используется для аутентификации в системе

**Принятое решение:**
1. **Текущее состояние:** Пакеты находятся на версии `1.5.2-6+deb12u1`
   - Доступных обновлений нет в Debian 12 (bookworm)
   - Обновления через security.debian.org также недоступны
2. **Меры по снижению риска:**
   - Контейнер работает от non-root пользователя (`appuser`)
   - PAM не используется напрямую в приложении
   - Ограничен доступ к конфигурационным файлам PAM (`/etc/pam.d/`)
   - Приложение использует собственную систему аутентификации через Telegram
3. **Планы на будущее:**
   - Мониторинг обновлений безопасности для Debian 12
   - Рассмотрение обновления базового образа при появлении исправлений
   - Регулярное сканирование для отслеживания изменений

**Обоснование:**
- Исправление недоступно для текущей версии Debian 12
- PAM не используется в приложении напрямую
- Контейнер работает в изолированной среде от non-root пользователя
- Принятые меры минимизируют риск эксплуатации

**Ссылка:** https://avd.aquasec.com/nvd/cve-2025-6020

---

### 3. libpam-*: CVE-2024-10041 (MEDIUM)

**Пакеты:**
- `libpam-modules`
- `libpam-modules-bin`
- `libpam-runtime`
- `libpam0g`

**Версия:** `1.5.2-6+deb12u1`  
**Уязвимость:** Libpam vulnerable to read hashed password  
**Статус:** `will_not_fix`  
**Дата обнаружения:** 2025-01-19

**Описание:**
Уязвимость, позволяющая читать хешированные пароли.

**Риск:**
- Средний риск эксплуатации
- Может привести к утечке информации о паролях

**Принятое решение:**
1. **Текущее состояние:** Пакеты находятся на последней доступной версии для Debian 12
2. **Меры по снижению риска:**
   - Контейнер работает от non-root пользователя
   - PAM не используется напрямую в приложении
   - Ограничен доступ к файлам `/etc/shadow` и `/etc/passwd`
   - Приложение использует собственную систему аутентификации через Telegram
3. **Планы на будущее:**
   - Мониторинг обновлений безопасности
   - Рассмотрение обновления базового образа

**Обоснование:**
- PAM не используется в приложении напрямую
- Контейнер работает в изолированной среде
- Принятые меры минимизируют риск эксплуатации

**Ссылка:** https://avd.aquasec.com/nvd/cve-2024-10041

---

## СРЕДНИЕ УЯЗВИМОСТИ (MEDIUM)

### 4. util-linux: CVE-2025-14104 (MEDIUM)

**Пакеты (8):**
- `bsdutils` (1:2.38.1-5+deb12u3)
- `libblkid1` (2.38.1-5+deb12u3)
- `libmount1` (2.38.1-5+deb12u3)
- `libsmartcols1` (2.38.1-5+deb12u3)
- `libuuid1` (2.38.1-5+deb12u3)
- `mount` (2.38.1-5+deb12u3)
- `util-linux` (2.38.1-5+deb12u3)
- `util-linux-extra` (2.38.1-5+deb12u3)

**Уязвимость:** Heap buffer overread в setpwnam()  
**Статус:** `affected`  
**Дата обнаружения:** 2025-01-19

**Описание:**
Уязвимость переполнения буфера в функции `setpwnam()` пакета util-linux, которая может привести к чтению данных за пределами выделенной памяти.

**Риск:**
- Средний риск эксплуатации
- Может привести к утечке информации или сбою приложения
- Требует длинных имен пользователей (>255 символов) для эксплуатации

**Принятое решение:**
1. **Текущее состояние:** Все пакеты находятся на версии `2.38.1-5+deb12u3`
   - Доступных обновлений нет в Debian 12 (bookworm)
   - Версия является последней доступной для Debian 12
2. **Меры по снижению риска:**
   - Контейнер работает от non-root пользователя (`appuser`)
   - Пользователь создан с нормальным именем (8 символов)
   - Нет пользователей с длинными именами (>255 символов)
   - Ограничен доступ к системным утилитам
3. **Планы на будущее:**
   - Мониторинг обновлений безопасности для Debian 12
   - Рассмотрение обновления базового образа при появлении исправлений

**Обоснование:**
- Все пакеты находятся на последней доступной версии
- Пользователь создан с нормальным именем, риск эксплуатации минимален
- Контейнер работает в изолированной среде от non-root пользователя
- Принятые меры минимизируют риск эксплуатации

**Ссылка:** https://avd.aquasec.com/nvd/cve-2025-14104

---

### 5. gpgv: CVE-2025-30258 (MEDIUM)

**Пакет:** `gpgv`  
**Версия:** `2.2.40-1.1+deb12u1`  
**Уязвимость:** Verification DoS due to malicious subkey  
**Статус:** `affected`  
**Дата обнаружения:** 2025-01-19

**Описание:**
Уязвимость отказа в обслуживании (DoS) в gpgv при проверке подписей с вредоносными подключами.

**Риск:**
- Средний риск эксплуатации
- Может привести к отказу в обслуживании при проверке подписей
- Требует доступа к вредоносным подключам

**Принятое решение:**
1. **Текущее состояние:** Пакет находится на версии `2.2.40-1.1+deb12u1`
   - Доступных обновлений нет в Debian 12 (bookworm)
   - Версия является последней доступной для Debian 12
2. **Меры по снижению риска:**
   - Контейнер работает от non-root пользователя
   - Ограничен доступ к GPG keyring
   - Используются только доверенные ключи (если используется)
   - Приложение не выполняет проверку GPG подписей напрямую
3. **Планы на будущее:**
   - Мониторинг обновлений безопасности для Debian 12
   - Рассмотрение обновления базового образа при появлении исправлений

**Обоснование:**
- Пакет находится на последней доступной версии
- Приложение не использует GPG для проверки подписей
- Контейнер работает в изолированной среде
- Принятые меры минимизируют риск эксплуатации

**Ссылка:** https://avd.aquasec.com/nvd/cve-2025-30258

---

### 6. ncurses: CVE-2023-50495 (MEDIUM)

**Пакеты (4):**
- `libncursesw6` (6.4-4)
- `libtinfo6` (6.4-4)
- `ncurses-base` (6.4-4)
- `ncurses-bin` (6.4-4)

**Уязвимость:** Segmentation fault via _nc_wrap_entry()  
**Статус:** `affected`  
**Дата обнаружения:** 2025-01-19

**Описание:**
Уязвимость сегментации в функции `_nc_wrap_entry()` библиотеки ncurses, которая может привести к сбою приложения.

**Риск:**
- Средний риск эксплуатации
- Может привести к отказу в обслуживании
- Требует специально сформированного ввода для эксплуатации

**Принятое решение:**
1. **Текущее состояние:** Все пакеты находятся на версии `6.4-4`
   - Доступных обновлений нет в Debian 12 (bookworm)
   - Версия является последней доступной для Debian 12
2. **Меры по снижению риска:**
   - Контейнер работает от non-root пользователя
   - ncurses не используется напрямую в приложении
   - Ограничен доступ к терминальным функциям
   - Приложение работает в веб-окружении без интерактивного терминала
3. **Планы на будущее:**
   - Мониторинг обновлений безопасности для Debian 12
   - Рассмотрение обновления базового образа при появлении исправлений

**Обоснование:**
- Все пакеты находятся на последней доступной версии
- ncurses не используется в приложении напрямую
- Контейнер работает в изолированной среде без интерактивного терминала
- Принятые меры минимизируют риск эксплуатации

**Ссылка:** https://avd.aquasec.com/nvd/cve-2023-50495

---

### 7. libsqlite3-0: CVE-2025-7709 (MEDIUM)

**Пакет:** `libsqlite3-0`  
**Версия:** `3.40.1-2+deb12u2`  
**Уязвимость:** Integer overflow in FTS5  
**Статус:** `affected`  
**Дата обнаружения:** 2025-01-19

**Описание:**
Уязвимость переполнения целого числа в модуле FTS5 (Full-Text Search) SQLite.

**Риск:**
- Средний риск эксплуатации
- Может привести к отказу в обслуживании или утечке информации
- Требует использования FTS5 для эксплуатации

**Принятое решение:**
1. **Текущее состояние:** Пакет находится на версии `3.40.1-2+deb12u2`
   - Доступных обновлений нет в Debian 12 (bookworm)
   - Версия является последней доступной для Debian 12
2. **Меры по снижению риска:**
   - SQLite не используется в production (используется PostgreSQL)
   - SQLite используется только в тестах (in-memory база данных)
   - Тесты выполняются в изолированной среде
   - FTS5 не используется в приложении
3. **Планы на будущее:**
   - Мониторинг обновлений безопасности для Debian 12
   - Рассмотрение обновления базового образа при появлении исправлений

**Обоснование:**
- Пакет находится на последней доступной версии
- SQLite не используется в production
- FTS5 не используется в приложении
- Тесты выполняются в изолированной среде
- Принятые меры минимизируют риск эксплуатации

**Ссылка:** https://avd.aquasec.com/nvd/cve-2025-7709

---

## НЕИЗВЕСТНЫЕ УЯЗВИМОСТИ (UNKNOWN)

### 8. libgnutls30: CVE-2025-9820 (UNKNOWN)

**Пакет:** `libgnutls30`  
**Версия:** `3.7.9-2+deb12u5`  
**Уязвимость:** Детали не указаны (UNKNOWN)  
**Статус:** `affected`  
**Дата обнаружения:** 2025-01-19

**Описание:**
Уязвимость в GnuTLS (GNU Transport Layer Security Library), детали которой не указаны в базе данных уязвимостей. Возможно, связана с GNUTLS-SA-2025-11-18 advisory.

**Риск:**
- Неизвестный уровень риска (требуется дополнительная информация)
- GnuTLS используется для TLS/SSL соединений
- Может влиять на безопасность сетевых соединений

**Принятое решение:**
1. **Текущее состояние:** Пакет находится на версии `3.7.9-2+deb12u5`
   - Доступных обновлений нет в Debian 12 (bookworm)
   - Версия является последней доступной для Debian 12
   - Проверено через основной репозиторий и security.debian.org
2. **Меры по снижению риска:**
   - Контейнер работает от non-root пользователя
   - GnuTLS используется косвенно через системные библиотеки Python
   - Регулярное обновление системных пакетов через `apt-get upgrade`
   - Мониторинг обновлений безопасности
3. **Планы на будущее:**
   - Мониторинг обновлений безопасности для Debian 12
   - Отслеживание деталей уязвимости через NVD и GNUTLS advisories
   - Рассмотрение обновления базового образа при появлении исправлений
   - Регулярное сканирование с помощью Trivy

**Обоснование:**
- Пакет находится на последней доступной версии
- GnuTLS используется косвенно через системные библиотеки
- Контейнер работает в изолированной среде от non-root пользователя
- Принятые меры минимизируют потенциальный риск эксплуатации
- Требуется дополнительная информация о деталях уязвимости

**Ссылка:** https://avd.aquasec.com/nvd/cve-2025-9820

**Примечание:** Рекомендуется регулярно проверять обновления и детали уязвимости, так как статус "UNKNOWN" может измениться при получении дополнительной информации.

---

## Использование SQLite в проекте

**Статус:** SQLite используется только в тестах

**Детали:**
- **Production:** Используется PostgreSQL через `asyncpg`
- **Тесты:** Используется SQLite через `aiosqlite` для in-memory базы данных
- **Зависимости:** `aiosqlite==0.19.0` (только для тестов)

**Уязвимости SQLite:**
- **CVE-2025-7458 (CRITICAL):** SQLite integer overflow
- **CVE-2025-7709 (MEDIUM):** Integer overflow in FTS5

**Меры:**
1. SQLite не используется в production
2. Тесты выполняются в изолированной среде
3. Регулярное обновление системных пакетов через `apt-get upgrade`
4. Мониторинг обновлений для `libsqlite3-0`

---

## Обновление системных пакетов

### Процесс обновления

1. **Автоматическое обновление:**
   - Dockerfile использует `apt-get upgrade -y` для обновления всех пакетов
   - Обновления применяются при каждой сборке образа

2. **Принудительное обновление:**
   - Для критичных пакетов можно явно указать обновление:
     ```dockerfile
     apt-get upgrade -y libsqlite3-0 zlib1g
     ```

3. **Обновление базового образа:**
   - Регулярное обновление `FROM python:3.11-slim-bookworm`
   - Использование `--pull` при сборке для получения последней версии

### Проверка обновлений

```bash
# Проверить доступные обновления
docker run --rm python:3.11-slim-bookworm bash -c \
  "apt-get update && apt list --upgradable"

# Проверить версию конкретного пакета
docker run --rm python:3.11-slim-bookworm bash -c \
  "apt-get update && apt-cache policy libsqlite3-0"
```

---

## CI/CD интеграция

### Автоматическое сканирование

Проект настроен на автоматическое сканирование уязвимостей через GitHub Actions:

```yaml
# Пример конфигурации (добавить в .github/workflows/)
- name: Scan for vulnerabilities
  run: |
    docker compose build backend
    trivy image --severity CRITICAL,HIGH tg_bot_hb-backend
```

### Уведомления

- Критические уязвимости: немедленное уведомление
- Высокие уязвимости: уведомление в течение 24 часов
- Средние уязвимости: еженедельный отчет

---

## Контакты для сообщений об уязвимостях

Если вы обнаружили уязвимость в проекте, пожалуйста:

1. **НЕ** создавайте публичный issue
2. Свяжитесь с командой разработки напрямую
3. Предоставьте детальное описание уязвимости
4. Укажите шаги для воспроизведения (если применимо)

---

## Ресурсы

- [Debian Security Advisories](https://www.debian.org/security/)
- [Trivy Documentation](https://aquasecurity.github.io/trivy/)
- [Docker Security Best Practices](https://docs.docker.com/develop/security-best-practices/)
- [OWASP Docker Security](https://owasp.org/www-project-docker-top-10/)

---

**Документ поддерживается:** Команда разработки  
**Следующий пересмотр:** После каждого обновления базового образа или обнаружения новых уязвимостей

